---
/**
 * 太阳系动画组件
 * 星空背景 + 可拖拽行星交互
 */
---

<div class="solar-system-wrapper">
    <!-- 星空背景 -->
    <div class="stars-container">
        <div class="stars stars-small"></div>
        <div class="stars stars-medium"></div>
        <div class="stars stars-large"></div>
    </div>
    
    <!-- 流星 -->
    <div class="shooting-stars">
        <div class="shooting-star"></div>
        <div class="shooting-star"></div>
        <div class="shooting-star"></div>
    </div>
    
    <!-- 太阳系 -->
    <div class="solar-system" id="solar-system">
        <!-- 太阳 -->
        <div class="sun" id="sun" title="太阳"></div>
        
        <!-- 轨道和行星 -->
        <div class="orbit" data-orbit="mercury"></div>
        <div class="planet mercury" id="mercury" data-planet="mercury" title="水星 - 拖拽我！"></div>
        
        <div class="orbit" data-orbit="venus"></div>
        <div class="planet venus" id="venus" data-planet="venus" title="金星 - 拖拽我！"></div>
        
        <div class="orbit" data-orbit="earth"></div>
        <div class="planet earth" id="earth" data-planet="earth" title="地球 - 拖拽我！">
            <div class="moon"></div>
        </div>
        
        <div class="orbit" data-orbit="mars"></div>
        <div class="planet mars" id="mars" data-planet="mars" title="火星 - 拖拽我！"></div>
        
        <div class="orbit" data-orbit="jupiter"></div>
        <div class="planet jupiter" id="jupiter" data-planet="jupiter" title="木星 - 拖拽我！"></div>
        
        <div class="orbit" data-orbit="saturn"></div>
        <div class="planet saturn" id="saturn" data-planet="saturn" title="土星 - 拖拽我！">
            <div class="saturn-ring"></div>
        </div>
    </div>
    
    <!-- 提示文字 -->
    <div class="hint-text">✨ 拖拽行星改变轨道 ✨</div>
</div>

<style>
.solar-system-wrapper {
    width: 100%;
    height: 350px;
    position: relative;
    overflow: hidden;
    background: linear-gradient(to bottom, 
        rgba(0, 0, 20, 0.1) 0%,
        rgba(0, 0, 40, 0.4) 50%,
        rgba(0, 0, 30, 0.6) 100%
    );
    border-radius: 1rem;
    margin-bottom: 1rem;
}

:root.dark .solar-system-wrapper {
    background: linear-gradient(to bottom,
        rgba(0, 0, 20, 0.3) 0%,
        rgba(0, 0, 50, 0.6) 50%,
        rgba(0, 0, 40, 0.8) 100%
    );
}

/* 星空 */
.stars-container {
    position: absolute;
    inset: 0;
    overflow: hidden;
}

.stars {
    position: absolute;
    width: 100%;
    height: 100%;
    background-repeat: repeat;
}

.stars-small {
    background-image: radial-gradient(1px 1px at 20px 30px, white, transparent),
                      radial-gradient(1px 1px at 40px 70px, rgba(255,255,255,0.8), transparent),
                      radial-gradient(1px 1px at 50px 160px, rgba(255,255,255,0.6), transparent),
                      radial-gradient(1px 1px at 90px 40px, white, transparent),
                      radial-gradient(1px 1px at 130px 80px, rgba(255,255,255,0.7), transparent),
                      radial-gradient(1px 1px at 160px 120px, white, transparent);
    background-size: 200px 200px;
    animation: twinkle 4s ease-in-out infinite;
}

.stars-medium {
    background-image: radial-gradient(1.5px 1.5px at 150px 50px, white, transparent),
                      radial-gradient(1.5px 1.5px at 200px 150px, rgba(255,255,255,0.9), transparent),
                      radial-gradient(1.5px 1.5px at 100px 200px, white, transparent),
                      radial-gradient(1.5px 1.5px at 250px 100px, rgba(255,255,255,0.8), transparent);
    background-size: 300px 300px;
    animation: twinkle 5s ease-in-out infinite 1s;
}

.stars-large {
    background-image: radial-gradient(2px 2px at 100px 100px, white, transparent),
                      radial-gradient(2px 2px at 300px 200px, rgba(255,255,255,0.9), transparent),
                      radial-gradient(2.5px 2.5px at 200px 50px, #ffffd0, transparent);
    background-size: 400px 300px;
    animation: twinkle 6s ease-in-out infinite 2s;
}

@keyframes twinkle {
    0%, 100% { opacity: 0.7; }
    50% { opacity: 1; }
}

/* 流星 */
.shooting-stars {
    position: absolute;
    inset: 0;
    overflow: hidden;
    pointer-events: none;
}

.shooting-star {
    position: absolute;
    width: 100px;
    height: 1px;
    background: linear-gradient(to right, white, transparent);
    opacity: 0;
    transform: rotate(-45deg);
}

.shooting-star:nth-child(1) {
    top: 20%;
    left: 10%;
    animation: shoot 8s ease-out infinite;
}

.shooting-star:nth-child(2) {
    top: 40%;
    left: 60%;
    animation: shoot 12s ease-out infinite 4s;
}

.shooting-star:nth-child(3) {
    top: 10%;
    left: 80%;
    animation: shoot 10s ease-out infinite 7s;
}

@keyframes shoot {
    0% { opacity: 0; transform: translateX(0) translateY(0) rotate(-45deg); }
    5% { opacity: 1; }
    15% { opacity: 0; transform: translateX(200px) translateY(200px) rotate(-45deg); }
    100% { opacity: 0; }
}

/* 太阳系容器 */
.solar-system {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 600px;
    height: 600px;
}

/* 太阳 */
.sun {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 40px;
    height: 40px;
    background: radial-gradient(circle, #fff700 0%, #ff9500 50%, #ff5500 100%);
    border-radius: 50%;
    box-shadow: 0 0 40px #ff9500, 0 0 80px #ff5500, 0 0 120px rgba(255, 100, 0, 0.5);
    animation: pulse 3s ease-in-out infinite;
    cursor: pointer;
    z-index: 10;
}

@keyframes pulse {
    0%, 100% { box-shadow: 0 0 40px #ff9500, 0 0 80px #ff5500, 0 0 120px rgba(255, 100, 0, 0.5); }
    50% { box-shadow: 0 0 60px #ff9500, 0 0 100px #ff5500, 0 0 150px rgba(255, 100, 0, 0.6); }
}

/* 轨道 */
.orbit {
    position: absolute;
    top: 50%;
    left: 50%;
    border: 1px dashed rgba(255, 255, 255, 0.15);
    border-radius: 50%;
    transform: translate(-50%, -50%);
    pointer-events: none;
    transition: border-color 0.3s, width 0.5s, height 0.5s;
}

.orbit:hover {
    border-color: rgba(255, 255, 255, 0.3);
}

[data-orbit="mercury"] { width: 70px; height: 70px; }
[data-orbit="venus"] { width: 100px; height: 100px; }
[data-orbit="earth"] { width: 140px; height: 140px; }
[data-orbit="mars"] { width: 180px; height: 180px; }
[data-orbit="jupiter"] { width: 240px; height: 240px; }
[data-orbit="saturn"] { width: 310px; height: 310px; }

/* 行星基础样式 */
.planet {
    position: absolute;
    border-radius: 50%;
    cursor: grab;
    transition: transform 0.1s, box-shadow 0.3s;
    z-index: 5;
}

.planet:hover {
    transform: scale(1.3);
    z-index: 20;
}

.planet.dragging {
    cursor: grabbing;
    z-index: 100;
    box-shadow: 0 0 20px rgba(255, 255, 255, 0.8);
}

/* 各行星样式 */
.mercury {
    width: 8px;
    height: 8px;
    background: linear-gradient(135deg, #b5b5b5, #8c8c8c);
}

.venus {
    width: 12px;
    height: 12px;
    background: linear-gradient(135deg, #ffd699, #cc9933);
}

.earth {
    width: 14px;
    height: 14px;
    background: linear-gradient(135deg, #6b93d6, #4f6d9a);
    box-shadow: 0 0 10px rgba(100, 150, 255, 0.5);
}

.moon {
    position: absolute;
    width: 4px;
    height: 4px;
    background: #ddd;
    border-radius: 50%;
    top: -10px;
    left: 50%;
    transform: translateX(-50%);
    animation: moon-orbit 3s linear infinite;
    pointer-events: none;
}

@keyframes moon-orbit {
    from { transform: translateX(-50%) rotate(0deg) translateY(-10px); }
    to { transform: translateX(-50%) rotate(360deg) translateY(-10px); }
}

.mars {
    width: 10px;
    height: 10px;
    background: linear-gradient(135deg, #e27b58, #8b4513);
}

.jupiter {
    width: 24px;
    height: 24px;
    background: linear-gradient(135deg, #d4a574 0%, #c88b3a 50%, #a67c52 100%);
}

.saturn {
    width: 20px;
    height: 20px;
    background: linear-gradient(135deg, #f4d59e, #c9a227);
}

.saturn-ring {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%) rotateX(70deg);
    width: 36px;
    height: 36px;
    border: 2px solid rgba(210, 180, 140, 0.6);
    border-radius: 50%;
    pointer-events: none;
}

/* 提示文字 */
.hint-text {
    position: absolute;
    bottom: 15px;
    left: 50%;
    transform: translateX(-50%);
    color: rgba(255, 255, 255, 0.5);
    font-size: 12px;
    pointer-events: none;
    animation: hint-fade 3s ease-in-out infinite;
}

@keyframes hint-fade {
    0%, 100% { opacity: 0.5; }
    50% { opacity: 0.8; }
}

/* 响应式 */
@media (max-width: 768px) {
    .solar-system-wrapper {
        height: 250px;
    }
    .solar-system {
        width: 360px;
        height: 360px;
    }
    .sun {
        width: 30px;
        height: 30px;
    }
    [data-orbit="mercury"] { width: 50px; height: 50px; }
    [data-orbit="venus"] { width: 70px; height: 70px; }
    [data-orbit="earth"] { width: 95px; height: 95px; }
    [data-orbit="mars"] { width: 120px; height: 120px; }
    [data-orbit="jupiter"] { width: 155px; height: 155px; }
    [data-orbit="saturn"] { width: 195px; height: 195px; }
    .mercury { width: 6px; height: 6px; }
    .venus { width: 8px; height: 8px; }
    .earth { width: 10px; height: 10px; }
    .mars { width: 7px; height: 7px; }
    .jupiter { width: 18px; height: 18px; }
    .saturn { width: 14px; height: 14px; }
    .saturn-ring { width: 26px; height: 26px; }
    .hint-text {
        font-size: 10px;
    }
}
</style>

<script>
document.addEventListener('DOMContentLoaded', () => {
    const solarSystem = document.getElementById('solar-system');
    if (!solarSystem) return;
    
    const planets = document.querySelectorAll('.planet[data-planet]');
    const isMobile = window.innerWidth <= 768;
    
    // 根据设备调整中心点和半径
    const containerSize = isMobile ? 360 : 600;
    const centerX = containerSize / 2;
    const centerY = containerSize / 2;
    
    // 行星配置 - 半径与 CSS 轨道尺寸匹配
    // 桌面端轨道: mercury=70, venus=100, earth=140, mars=180, jupiter=240, saturn=310
    // 手机端轨道: mercury=50, venus=70, earth=95, mars=120, jupiter=155, saturn=195
    const planetConfig = isMobile ? {
        mercury: { radius: 25, speed: 0.02, angle: Math.random() * Math.PI * 2 },
        venus: { radius: 35, speed: 0.015, angle: Math.random() * Math.PI * 2 },
        earth: { radius: 47.5, speed: 0.01, angle: Math.random() * Math.PI * 2 },
        mars: { radius: 60, speed: 0.008, angle: Math.random() * Math.PI * 2 },
        jupiter: { radius: 77.5, speed: 0.005, angle: Math.random() * Math.PI * 2 },
        saturn: { radius: 97.5, speed: 0.003, angle: Math.random() * Math.PI * 2 }
    } : {
        mercury: { radius: 35, speed: 0.02, angle: Math.random() * Math.PI * 2 },
        venus: { radius: 50, speed: 0.015, angle: Math.random() * Math.PI * 2 },
        earth: { radius: 70, speed: 0.01, angle: Math.random() * Math.PI * 2 },
        mars: { radius: 90, speed: 0.008, angle: Math.random() * Math.PI * 2 },
        jupiter: { radius: 120, speed: 0.005, angle: Math.random() * Math.PI * 2 },
        saturn: { radius: 155, speed: 0.003, angle: Math.random() * Math.PI * 2 }
    };
    
    let draggingPlanet = null;
    let animationId = null;
    
    // 更新行星位置
    function updatePlanetPosition(planet, config) {
        const x = centerX + Math.cos(config.angle) * config.radius - planet.offsetWidth / 2;
        const y = centerY + Math.sin(config.angle) * config.radius - planet.offsetHeight / 2;
        planet.style.left = x + 'px';
        planet.style.top = y + 'px';
    }
    
    // 更新轨道大小
    function updateOrbit(planetName, radius) {
        const orbit = document.querySelector(`[data-orbit="${planetName}"]`);
        if (orbit) {
            const size = radius * 2;
            orbit.style.width = size + 'px';
            orbit.style.height = size + 'px';
        }
    }
    
    // 动画循环
    function animate() {
        planets.forEach(planet => {
            const name = planet.dataset.planet;
            const config = planetConfig[name];
            
            if (planet !== draggingPlanet) {
                config.angle += config.speed;
                updatePlanetPosition(planet, config);
            }
        });
        
        animationId = requestAnimationFrame(animate);
    }
    
    // 获取相对于太阳系容器的坐标
    function getRelativeCoords(e) {
        const rect = solarSystem.getBoundingClientRect();
        const clientX = e.touches ? e.touches[0].clientX : e.clientX;
        const clientY = e.touches ? e.touches[0].clientY : e.clientY;
        
        const x = clientX - rect.left - rect.width / 2;
        const y = clientY - rect.top - rect.height / 2;
        
        return { x, y };
    }
    
    // 开始拖拽
    function startDrag(e, planet) {
        e.preventDefault();
        draggingPlanet = planet;
        planet.classList.add('dragging');
    }
    
    // 拖拽中
    function onDrag(e) {
        if (!draggingPlanet) return;
        
        const coords = getRelativeCoords(e);
        const name = draggingPlanet.dataset.planet;
        const config = planetConfig[name];
        
        // 计算新的半径和角度
        const maxRadius = isMobile ? 97.5 : 155;
        config.radius = Math.max(20, Math.min(maxRadius, Math.sqrt(coords.x * coords.x + coords.y * coords.y)));
        config.angle = Math.atan2(coords.y, coords.x);
        
        updatePlanetPosition(draggingPlanet, config);
        updateOrbit(name, config.radius);
    }
    
    // 结束拖拽
    function endDrag() {
        if (draggingPlanet) {
            draggingPlanet.classList.remove('dragging');
            draggingPlanet = null;
        }
    }
    
    // 绑定事件
    planets.forEach(planet => {
        planet.addEventListener('mousedown', (e) => startDrag(e, planet));
        planet.addEventListener('touchstart', (e) => startDrag(e, planet), { passive: false });
    });
    
    document.addEventListener('mousemove', onDrag);
    document.addEventListener('touchmove', onDrag, { passive: false });
    document.addEventListener('mouseup', endDrag);
    document.addEventListener('touchend', endDrag);
    
    // 太阳点击效果 - 重置所有行星
    const defaultRadii = isMobile ? {
        mercury: 25, venus: 35, earth: 47.5, mars: 60, jupiter: 77.5, saturn: 97.5
    } : {
        mercury: 35, venus: 50, earth: 70, mars: 90, jupiter: 120, saturn: 155
    };
    
    document.getElementById('sun')?.addEventListener('click', () => {
        Object.keys(defaultRadii).forEach(name => {
            planetConfig[name].radius = defaultRadii[name];
            updateOrbit(name, defaultRadii[name]);
        });
    });
    
    // 初始化轨道大小
    Object.keys(planetConfig).forEach(name => {
        updateOrbit(name, planetConfig[name].radius);
    });
    
    // 初始化位置并开始动画
    planets.forEach(planet => {
        const name = planet.dataset.planet;
        updatePlanetPosition(planet, planetConfig[name]);
    });
    
    animate();
});
</script>
